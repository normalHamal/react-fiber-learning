<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Fiber reconciliation</title>
  </head>
  <body>
    <div id="container">
    </div>
    <script src="js/react.development.js"></script>
    <script src="js/react-dom.development.js"></script>
    <script src="js/scheduler.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>
    <script type="text/babel">
class Low extends React.Component {
  componentWillUpdate(nextProps) {
    console.log('%c componentWillUpdata fired', 'color: #fff;background: #6190e8;', nextProps);
  }

  componentWillMount() {
    console.log('%c componentWillMount fired', 'color: #fff;background: #6190e8;');
  }

  componentWillReceiveProps(args) {
    console.log('%c componentWillReceiveProps fired', 'color: #fff;background: #6190e8;', args);
  }

  render() {
    const { props } = this;

    return (
      <React.Fragment>
      {Array.from({ length: 100 }).map((_, i) => (<div key={i}><h2>{props.text}-{i}</h2></div>))}
      </React.Fragment>
    )
  }
}

class App extends React.Component {
  constructor() {
    super();
    this.state = { text: '' };
  }

  handleClick() {
    Scheduler.unstable_scheduleCallback(Scheduler.unstable_NormalPriority, () => {
      console.log('%c 插入低优先级任务 B', 'color: #fff;background: #898b17;');
      this.setState(state => ({
        text: state.text + 'B'
      }));
    });

    Scheduler.unstable_scheduleCallback(Scheduler.unstable_UserBlockingPriority, () => {
      console.log('%c 插入高优先级任务 A', 'color: #fff;background: #898b17;');
      this.setState(state => ({
        text: state.text + 'A'
      }));
    }, {
      delay: 10
    });
  }

  render() {
    const { text, isShow } = this.state;

    return (
      <React.Fragment>
        <button onClick={this.handleClick.bind(this)}>开始模拟调度</button>
        <Low text={text} />
      </React.Fragment>
    );
  }
}

ReactDOM.createRoot(
  document.getElementById('container')
).render(<App />);
    </script>
  </body>
</html>
