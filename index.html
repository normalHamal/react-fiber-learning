<!DOCTYPE html>
<html>

<head>
  <title>Vue app</title>
</head>

<body>
  <div id="root"></div>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script type="text/javascript">
    const start = new Date().getTime();

    function update() {
      const elapsed = new Date().getTime() - start;
      const t = (elapsed / 1000) % 10;
      const scale = 1 + (t > 5 ? 10 - t : t) / 10;
      document.querySelector('#anim').style.transform = 'scaleX(' + (scale / 2.1) + ') scaleY(0.7) translateZ(0.1px)';
      requestAnimationFrame(update);
    }
    requestAnimationFrame(update);

    const dotStyle = {
      position: 'absolute',
      background: '#61dafb',
      font: 'normal 15px sans-serif',
      textAlign: 'center',
      cursor: 'pointer',
    };

    const containerStyle = {
      position: 'absolute',
      transformOrigin: '0 0',
      left: '50%',
      top: '50%',
      width: '10px',
      height: '10px',
      background: '#eee',
    };

    const targetSize = 25;

    const Dot = {
      props: ['size', 'text', 'x', 'y'],
      data() {
        return {
          hover: false,
          style: {}
        };
      },
      created() {
        const s = this.size * 1.3;
        this.style = {
          ...dotStyle,
          width: s + 'px',
          height: s + 'px',
          left: (this.x) + 'px',
          top: (this.y) + 'px',
          borderRadius: (s / 2) + 'px',
          lineHeight: (s) + 'px',
          background: this.hover ? '#ff0' : dotStyle.background
        };
      },
      methods: {
        enter() {
          this.hover = true;
        },
        leave() {
          this.hover = false;
        }
      },
      template: `<div :style="style" @mouseEnter="enter" @mouseLeave="leave">
        {{hover ? '*' + text + '*' : text}}
      </div>`
    }

    Vue.component('SierpinskiTriangle', {
      functional: true,
      render: function (createElement, context) {
        function createTriangle({ x, y, s, seconds }) {
          if (s <= targetSize) {
            return createElement(
              Dot,
              {
                props: {
                  x: x - (targetSize / 2),
                  y: y - (targetSize / 2),
                  size: targetSize,
                  text: seconds,
                  key: `${x}-${y}`,
                }
              },
              null
            );
          }
          const slowDown = true;
          if (slowDown) {
            const e = performance.now() + 0.8;
            while (performance.now() < e) {
              // Artificially long execution time.
            }
          }

          s /= 2;
          return createElement(
            'div',
            context.data,
            [
              createTriangle({ x, y: y - (s / 2), s, seconds }),
              createTriangle({ x: x - s, y: y + (s / 2), s, seconds }),
              createTriangle({ x: x + s, y: y + (s / 2), s, seconds }),
            ]
          )
        }

        return createTriangle(context.props);
      }
    });

    new Vue({
      el: '#root',
      data: {
        seconds: 0,
        containerStyle
      },
      created() {
        this.intervalID = setInterval(this.tick, 1000);
      },
      destory() {
        clearInterval(this.intervalID);
      },
      methods: {
        tick() {
          this.seconds = (this.seconds % 10) + 1;
        }
      },
      template: `
        <div :style="containerStyle" id="anim">
          <div>
            <SierpinskiTriangle :x="0" :y="0" :s="1000" :seconds="seconds">
            </SierpinskiTriangle>
          </div>
        </div>
      `
    });

  </script>
</body>

</html>
