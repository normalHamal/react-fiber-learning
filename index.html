<!DOCTYPE html>
<html style="width: 100%; height: 100%; overflow: hidden">
  <head>
    <meta charset="utf-8">
    <title>Fiber reconciliation</title>
  </head>
  <body>
    <div id="container">
    </div>
    <script src="js/react.development.js"></script>
    <script src="js/react-dom.development.js"></script>
    <script src="js/scheduler.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>
    <script type="text/babel">
      class List extends React.Component {
        componentWillUpdate() {
          console.error('List componentWillUpdata fired');
        }

        componentWillMount() {
          console.error('List componentWillMount fired');
        }

        componentWillReceiveProps() {
          console.error('List componentWillReceiveProps fired');
        }

        render() {
          const { props } = this;

          return (
            <React.Fragment>
            <h2>{props.text}</h2>
            {Array.from({ length: props.len }).map((_, i) => (<div key={i}>{i}</div>))}
            </React.Fragment>
          )
        }
      }

      class App extends React.Component {
        constructor() {
          super();
          this.state = { len: 0, text: '' };
        }

        componentWillUpdate() {
          console.error('App componentWillUpdata fired');
        }

        componentWillMount() {
          console.error('App componentWillMount fired');
        }

        componentWillReceiveProps() {
          console.error('App componentWillReceiveProps fired');
        }

        handleClick(incr) {
          this.setState((state) => ({ len: state.len + incr }));
          this.runHighPriority();
        }

        runHighPriority() {
          Scheduler.unstable_scheduleCallback(Scheduler.unstable_NormalPriority, () => {
            this.setState({
              text: '插入一个高优先级的任务',
              state: 10
            });
          });
        }

        render() {
          const { len } = this.state;

          return (
            <React.Fragment>
              <div>{len}</div>
              <button onClick={this.handleClick.bind(this, 2)}>一次递增2</button>
              <button onClick={this.handleClick.bind(this, 1000)}>一次递增1000</button>
              <List len={len} text={this.state.text} />
            </React.Fragment>
          );
        }
      }

      ReactDOM.createRoot(
        document.getElementById('container')
      ).render(<App />);
      // ReactDOM.render(<App />, document.getElementById('container'));
    </script>
  </body>
</html>
